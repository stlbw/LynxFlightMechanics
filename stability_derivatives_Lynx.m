function [A_long, A_lat, A_coupled, B_hover] = stability_derivatives_Lynx(V)
%STABILITY_DERIVATIVES_LYNX Returns the stability derivatives for the
%longitudinal and latero-directional planes in matrix form (0 kts, 40 kts and 80 kts). Also returns
%the Command matrix B for hover. 

    g = 9.81; %[m/s]
    tauC = 0;%[deg]

    A(:,:,1) = [-0.0199 0.0215 0.6674 -9.7837 -0.0205 -0.1600 0.0000 0.0000
0.0237 -0.3108 0.0134 -0.7215 -0.0028 -0.0054 0.5208 0.0000
0.0468 0.0055 -1.8954 0.0000 0.0588 0.4562 0.0000 0.0000
0.0000 0.0000 0.9985 0.0000 0.0000 0.0000 0.0000 0.0532
0.0207 0.0002 -0.1609 0.0380 -0.0351 -0.6840 9.7697 0.0995
0.3397 0.0236 -2.6449 0.0000 -0.2715 -10.9759 0.0000 -0.0203
0.0000 0.0000 -0.0039 0.0000 0.0000 1.0000 0.0000 0.0737
0.0609 0.0089 -0.4766 0.0000 -0.0137 -1.9367 0.0000 -0.2743];

    A(:,:,2) = [-0.0146 0.0347 -0.5681 -9.7934 -0.0083 -0.1321 0.0000 0.0000
-0.1186 -0.6156 20.6855 -0.5779 -0.0180 -0.2022 0.3519 0.0000
0.0319 0.0212 -2.1033 0.0000 0.0277 0.4210 0.0000 0.0000
0.0000 0.0000 0.9994 0.0000 0.0000 0.0000 0.0000 0.0359
0.0070 0.0184 -0.1303 0.0205 -0.0915 0.5342 9.7869 -20.3077
-0.0255 0.3040 -2.1361 0.0000 -0.1949 -10.7839 0.0000 -0.1441
0.0000 0.0000 -0.0021 0.0000 0.0000 1.0000 0.0000 0.0590
-0.0325 0.0314 -0.2522 0.0000 0.0316 -1.8857 0.0000 -0.68597];

    A(:,:,3) = [-0.0322 0.0403 -0.2262 -9.8081 -0.0021 -0.1086 0.0000 0.0000
-0.0010 -0.8018 41.0936 -0.2113 -0.0194 -0.4512 0.3223 0.0000
0.0271 0.0288 -2.3350 0.0000 0.0104 0.4102 0.0000 0.0000
0.0000 0.0000 0.9995 0.0000 0.0000 0.0000 0.0000 0.0329
0.0032 0.0143 -0.1287 0.0069 -0.1535 0.2134 9.8028 -40.7844
-0.0371 0.2344 -1.9959 0.0000 -0.1659 -10.5388 0.0000 -0.2668
0.0000 0.0000 -0.0007 0.0000 0.0000 1.0000 0.0000 0.0215
-0.0227 0.0025 -0.0877 0.0000 0.0662 -1.8331 0.0000 -1.0840];

    Xu(:) = A(1,1,:);
    Xw(:) = A(1,2,:);
    Xq(:) = A(1,3,:);
    Zu(:) = A(2,1,:);
    Zw(:) = A(2,2,:);
    Zq(:) = A(2,3,:);
    Mu(:) = A(3,1,:);
    Mw(:) = A(3,2,:);
    Mq(:) = A(3,3,:);
    Yv(:) = A(5,5,:);
    Yp(:) = A(5,6,:);
    Yr(:) = A(5,8,:);
    Lv(:) = A(6,5,:);
    Lp(:) = A(6,6,:);
    Lr(:) = A(6,8,:);
    Nv(:) = A(8,5,:);
    Np(:) = A(8,6,:);
    Nr(:) = A(8,8,:);

    Xv(:) = A(1,5,:);
    Xp(:) = A(1,6,:);
    Xr(:) = A(1,8,:);
    Zv(:) = A(2,5,:);
    Zp(:) = A(2,6,:);
    Zr(:) = A(2,8,:);
    Mv(:) = A(3,5,:);
    Mp(:) = A(3,6,:);
    Mr(:) = A(3,8,:);
    Yu(:) = A(5,1,:);
    Yw(:) = A(5,2,:);
    Yq(:) = A(5,3,:);
    Lu(:) = A(6,1,:);
    Lw(:) = A(6,2,:);
    Lq(:) = A(6,3,:);
    Nu(:) = A(8,1,:);
    Nw(:) = A(8,2,:);
    Nq(:) = A(8,3,:);

%Command matrix in hover conditions
B = [6.9417 -9.2860 2.0164 0.0000
-93.9179 -0.0020 -0.0003 0.0000
0.9554 26.4011 -5.7326 0.0000
0.0000 0.0000 0.0000 0.0000
-0.3563 -2.0164 -9.2862 3.6770
7.0476 -33.2120 -152.9537 -0.7358
0.0000 0.0000 0.0000 0.0000
17.3054 -5.9909 -27.5911 -9.9111];

    for i=1:length(V)
       A_long(:,:,i) = [Xu(i) Xw(i) Xq(i) -g*cos(tauC);
                   Zu(i) Zw(i) Zq(i) -g*sin(tauC);
                   Mu(i) Mw(i) Mq(i) 0;
                   0 0 1 0];
               
       A_lat(:,:,i) = [Yv(i) Yp(i) Yr(i) g*cos(tauC) 0;
                  Lv(i) Lp(i) Lr(i) 0 0;
                  Nv(i) Np(i) Nr(i) 0 0;
                  0 1 0 0 0;
                  0 0 1 0 0];

       A_coupled(:,:,i) = [Xu(i) Xw(i) Xq(i) -g*cos(tauC) Xv(i) Xp(i) Xr(i) 0 0
           Zu(i) Zw(i) Zq(i) -g*sin(tauC) Zv(i) Zp(i) Zr(i) 0 0
           Mu(i) Mw(i) Mq(i) 0 Mv(i) Mp(i) Mr(i) 0 0
           0 0 1 0 0 0 0 0 0
           Yu(i) Yw(i) Yq(i) 0 Yv(i) Yp(i) Yr(i) g*cos(tauC) 0
           Lu(i) Lw(i) Lq(i) 0 Lv(i) Lp(i) Lr(i) 0 0
           Nu(i) Nw(i) Nq(i) 0 Nv(i) Np(i) Nr(i) 0 0
           0 0 0 0 0 1 0 0 0
           0 0 0 0 0 0 1 0 0]; 
    end
    
    B_hover = [B(1,1) -B(1,2)
               B(2,1) -B(2,2)
               B(3,1) -B(3,2)
               0 0];

end